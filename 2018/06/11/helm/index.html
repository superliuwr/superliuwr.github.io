<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Helm | SUPERLOG</title>
  <meta name="viewport" content="width=device-width">
  <meta name="description" content="IntroductionHelm is a package manager for Kubernetes applications. Helm packages all of the different Kubernetes resources (such as deployments, services, and ingress) into a chart, which may be hoste">
<meta name="keywords" content="Helm,Kubernetes">
<meta property="og:type" content="article">
<meta property="og:title" content="Helm">
<meta property="og:url" content="http://superliuwr.github.io/2018/06/11/helm/index.html">
<meta property="og:site_name" content="SUPERLOG">
<meta property="og:description" content="IntroductionHelm is a package manager for Kubernetes applications. Helm packages all of the different Kubernetes resources (such as deployments, services, and ingress) into a chart, which may be hoste">
<meta property="og:locale" content="default">
<meta property="og:updated_time" content="2018-06-29T13:18:21.028Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Helm">
<meta name="twitter:description" content="IntroductionHelm is a package manager for Kubernetes applications. Helm packages all of the different Kubernetes resources (such as deployments, services, and ingress) into a chart, which may be hoste">
  
    <link rel="alternative" href="/atom.xml" title="SUPERLOG" type="application/atom+xml">
  
  
    <link rel="icon" href="images/favicon.ico">
  
  <link rel="stylesheet" href="/css/style.css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  
</head>
<body>
  <div id="container">
    <div class="mobile-nav-panel">
	<i class="icon-reorder icon-large"></i>
</div>
<header id="header">
	<h1 class="blog-title">
		<a href="/">SUPERLOG</a>
	</h1>
	<nav class="nav">
		<ul>
			<li><a href="/">Home</a></li><li><a href="/categories/">Categories</a></li><li><a href="/tags/">Tags</a></li><li><a href="/archives">Archives</a></li><li><a href="/about">About</a></li>
			<li><a id="nav-search-btn" class="nav-icon" title="Search"></a></li>
			<li><a href="/atom.xml" id="nav-rss-link" class="nav-icon" title="RSS Feed"></a></li>
		</ul>
	</nav>
	<div id="search-form-wrap">
		<form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://superliuwr.github.io"></form>
	</div>
</header>
    <div id="main">
      <article id="post-helm" class="post">
	<footer class="entry-meta-header">
		<span class="meta-elements date">
			<a href="/2018/06/11/helm/" class="article-date">
  <time datetime="2018-06-11T13:04:25.000Z" itemprop="datePublished">2018-06-11</time>
</a>
		</span>
		<span class="meta-elements author">Marvin Liu</span>
		<div class="commentscount">
			
		</div>
	</footer>
	
	<header class="entry-header">
		
  
    <h1 class="article-title entry-title" itemprop="name">
      Helm
    </h1>
  

	</header>
	<div class="entry-content">
		
    	<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>Helm is a package manager for Kubernetes applications.</p>
<p>Helm packages all of the different Kubernetes resources (such as deployments, services, and ingress) into a chart, which may be hosted in a repository.</p>
<p>Users can pull down charts and install them on any number of Kubernetes clusters.</p>
<p>Helm’s approach scales from monoliths to complex micro service applications. </p>
<p>Helm itself uses a client-server model. The helm command (the client) talks to the tiller  (the server). The Helm client may interact with any number of different tiller services. In practice, there is a single tiller service running one Kubernetes cluster. This helps teams collaborate. It also means that Helm may run anywhere, such as on your CI servers or on your own computer. Tiller does the work to coordinate with Kubernetes and get the chart installed.</p>
<a id="more"></a>
<h1 id="Install-Helm"><a href="#Install-Helm" class="headerlink" title="Install Helm"></a>Install Helm</h1><p>Run following to create a service account for Tiller in GCE as Kubernetes enables RBAC since version 1.8:</p>
<ul>
<li>kubectl create serviceaccount –namespace kube-system tiller</li>
<li>kubectl create clusterrolebinding tiller-cluster-rule –clusterrole=cluster-admin –serviceaccount=kube-system:tiller</li>
<li>kubectl patch deploy –namespace kube-system tiller-deploy -p ‘{“spec”:{“template”:{“spec”:{“serviceAccount”:”tiller”}}}}’      </li>
<li>helm init –service-account tiller –upgrade</li>
</ul>
<p><code>brew install kubernetes-helm</code></p>
<p><code>helm init</code>:<br>This will install Tiller in the cluster defined by your context according to your Kubectl configuration.</p>
<p>To check if Tiller is running:<br><code>kubectl -n kube-system get pods|grep tiller</code></p>
<h1 id="Frequently-Used-Commands"><a href="#Frequently-Used-Commands" class="headerlink" title="Frequently Used Commands"></a>Frequently Used Commands</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">helm repo update</span><br><span class="line"></span><br><span class="line">helm install stable/mysql</span><br><span class="line"></span><br><span class="line">helm ls</span><br><span class="line"></span><br><span class="line">helm delete smiling-penguin</span><br><span class="line"></span><br><span class="line">helm status smiling-penguin</span><br><span class="line"></span><br><span class="line">helm get -h</span><br></pre></td></tr></table></figure>
<h1 id="Using-Helm"><a href="#Using-Helm" class="headerlink" title="Using Helm"></a>Using Helm</h1><h2 id="Three-big-concepts"><a href="#Three-big-concepts" class="headerlink" title="Three big concepts"></a>Three big concepts</h2><ul>
<li>A Chart is a Helm package. It contains all of the resource definitions necessary to run an application, tool, or service inside of a Kubernetes cluster. Think of it like the Kubernetes equivalent of a Homebrew formula, an Apt dpkg, or a Yum RPM file.</li>
<li>A Repository is the place where charts can be collected and shared. It is like Perl’s CPAN archive or the Fedora Package Database, but for Kubernetes packages.</li>
<li>A Release is an instance of a chart running in a Kubernetes cluster. One chart can often be installed many times into the same cluster. And each time it is installed, a new release is created. Consider a MySQL chart. If you want two databases running in your cluster, you can install that chart twice. Each one will have its own release, which will in turn have its own release name.</li>
</ul>
<p>With these concepts in mind, we can now explain Helm like this:</p>
<ul>
<li>Helm installs charts into Kubernetes, creating a new release for each installation. And to find new charts, you can search Helm chart repositories.</li>
</ul>
<h1 id="Usage"><a href="#Usage" class="headerlink" title="Usage"></a>Usage</h1><p>To find predefined charts:</p>
<ul>
<li>helm search</li>
<li>helm search mysql</li>
</ul>
<p>To check a chart:</p>
<ul>
<li>helm inspect stable/mariadb</li>
</ul>
<p>To install dependencies of a chart:</p>
<ul>
<li>helm dep up foochart</li>
</ul>
<p>To install a chart with default config:</p>
<ul>
<li>helm install stable/mariadb</li>
</ul>
<p>To check status of a release:</p>
<ul>
<li>helm status happy-panda</li>
</ul>
<p>To see what options are configurable in a chart:</p>
<ul>
<li>helm inspect values stable/mariadb</li>
</ul>
<p>Then override some config then install:</p>
<ul>
<li>helm install -f config.yaml stable/mariadb</li>
</ul>
<p>Update a release:</p>
<ul>
<li>helm upgrade -f panda.yaml happy-panda stable/mariadb</li>
</ul>
<p>Check custom config:</p>
<ul>
<li>helm get values happy-panda</li>
</ul>
<p>Roll back a release to given revision:</p>
<ul>
<li>helm rollback happy-panda 1</li>
</ul>
<p>Uninstall a release:</p>
<ul>
<li>helm delete happy-panda</li>
</ul>
<p>Show releases:</p>
<ul>
<li>helm list —all</li>
<li>helm list —deleted</li>
</ul>
<p>Working with Repos:</p>
<ul>
<li>helm repo list</li>
<li>helm repo add dev <a href="https://example.com/dev-charts" target="_blank" rel="noopener">https://example.com/dev-charts</a></li>
</ul>
<p>Creating and installing charts:</p>
<ul>
<li>helm create deis-workflow</li>
<li>helm lint</li>
<li>helm package deis-workflow</li>
<li>helm install –dry-run –debug &lt;chart_dir&gt;</li>
<li>helm install ./deis-workflow-0.1.0.tgz</li>
</ul>
<p>After installation:</p>
<ul>
<li>export POD_NAME=$(kubectl get pods —namespace default -l “app=hello-helm,release=kilted-bobcat” -o jsonpath=”{.items[0].metadata.name}”)</li>
<li>kubectl port-forward $POD_NAME 8080:80</li>
</ul>
<p>Then you can now access the service you just installed by visiting <a href="http://127.0.0.1:8080" target="_blank" rel="noopener">http://127.0.0.1:8080</a></p>
<h1 id="Charts"><a href="#Charts" class="headerlink" title="Charts"></a>Charts</h1><p>A chart contains:</p>
<ul>
<li>Chart.yml that describes the chart (this includes the name, description, and version information that we saw in helm search)</li>
<li>One or more Kubernetes manifest templates (deployment, pod, service, etc.)</li>
<li>An optional third item: values.yml. This file declares the default values used at the time of installation. These may be overridden at installation via the —set or -f flags</li>
</ul>
<p>Inside of this directory, Helm will expect a structure that matches this:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">wordpress/</span><br><span class="line">  Chart.yaml          # A YAML file containing information about the chart</span><br><span class="line">  LICENSE             # OPTIONAL: A plain text file containing the license for the chart</span><br><span class="line">  README.md           # OPTIONAL: A human-readable README file</span><br><span class="line">  requirements.yaml   # OPTIONAL: A YAML file listing dependencies for the chart</span><br><span class="line">  values.yaml         # The default configuration values for this chart</span><br><span class="line">  charts/             # A directory containing any charts upon which this chart depends.</span><br><span class="line">  templates/          # A directory of templates that, when combined with values,</span><br><span class="line">                      # will generate valid Kubernetes manifest files.</span><br><span class="line">  templates/NOTES.txt # OPTIONAL: A plain text file containing short usage notes</span><br></pre></td></tr></table></figure>
<p>Helm Chart templates are written in the Go template language, with the addition of 50 or so add-on template functions from the Sprig library and a few other specialized functions.</p>
<p>All template files are stored in a chart’s templates/ folder. When Helm renders the charts, it will pass every file in that directory through the template engine.</p>
<p>Values that are supplied via a values.yaml file (or via the –set flag) are accessible from the .Values object in a template.</p>
<p>Pre-defined values: .Values, Chart, Release, etc.</p>
<h1 id="CI-CD"><a href="#CI-CD" class="headerlink" title="CI/CD"></a>CI/CD</h1><p>To be added</p>
<h1 id="References"><a href="#References" class="headerlink" title="References"></a>References</h1><ol>
<li><a href="https://www.influxdata.com/blog/packaged-kubernetes-deployments-writing-helm-chart/" target="_blank" rel="noopener">https://www.influxdata.com/blog/packaged-kubernetes-deployments-writing-helm-chart/</a></li>
</ol>

    
	</div>
	<footer class="entry-footer">
		<div class="entry-meta-footer">
			<span class="category">
				
  <div class="article-category">
    <a class="article-category-link" href="/categories/DevOps/">DevOps</a>
  </div>

			</span>
			<span class="tags">
				
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Helm/">Helm</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Kubernetes/">Kubernetes</a></li></ul>

			</span>
		</div>
	</footer>
	
    
<nav id="article-nav">
  
    <a href="/2018/06/12/kubernetes-overview/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Kubernetes Overview
        
      </div>
    </a>
  
  
    <a href="/2018/06/10/code-review-checklist/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">
        
          Code Review Checklist
        
      </div>
    </a>
  
</nav>

  
</article>




    </div>
    <div class="mb-search">
  <form action="//google.com/search" method="get" accept-charset="utf-8">
    <input type="search" name="q" results="0" placeholder="Search">
    <input type="hidden" name="q" value="site:superliuwr.github.io">
  </form>
</div>
<footer id="footer">
	<h1 class="footer-blog-title">
		<a href="/">SUPERLOG</a>
	</h1>
	<span class="copyright">
		&copy; 2018 Marvin Liu<br>
		Modify from <a href="http://sanographix.github.io/tumblr/apollo/" target="_blank">Apollo</a> theme, designed by <a href="http://www.sanographix.net/" target="_blank">SANOGRAPHIX.NET</a><br>
		Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
	</span>
</footer>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>
  </div>
</body>
</html>